"""
========================================================================
TyxonQ è„‰å†²è°ƒæ•™å®æˆ˜æ•™ç¨‹ - ç¬¬ 6 æ­¥ï¼šç³»ç»Ÿé›†æˆä¸éªŒè¯
========================================================================

æœ¬æ­¥éª¤çš„ç›®çš„æ˜¯ï¼š
âœ… å°†å•æ¯”ç‰¹å’ŒåŒæ¯”ç‰¹é—¨æ•´åˆä¸ºå®Œæ•´çš„ç³»ç»Ÿ
âœ… æµ‹è¯•å¤šæ¯”ç‰¹ç”µè·¯ï¼ˆGHZ æ€åˆ¶å¤‡ï¼‰
âœ… è¡¨å¾ç³»ç»Ÿæ•´ä½“æ€§èƒ½ï¼ˆç›¸å¹²æ—¶é—´ã€åŒæ—¶é—¨é”™è¯¯ï¼‰
âœ… ä¸ºå®é™…é‡å­ç®—æ³•åº”ç”¨åšå‡†å¤‡

å­¦ä¹ é¢„æœŸæ—¶é—´ï¼š75 åˆ†é’Ÿ
éš¾åº¦ï¼šâ˜…â˜…â˜…â˜…â˜…

========================================================================
"""

import numpy as np
from tyxonq import Circuit, waveforms
from tyxonq.core.ir.pulse import PulseProgram

print("""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  TyxonQ è„‰å†²è°ƒæ•™æ•™ç¨‹ - ç¬¬ 6 æ­¥ï¼šç³»ç»Ÿé›†æˆä¸éªŒè¯                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
""")

# ========================================================================
# ç¬¬ 6.1 éƒ¨åˆ†ï¼šå®Œæ•´æ ¡å‡†åº“çš„æ„å»º
# ========================================================================

print("""
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
6.1 æ„å»ºå®Œæ•´çš„ç¡¬ä»¶æ ¡å‡†åº“ (DefcalLibrary)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""")

# æ±‡æ€»æ‰€æœ‰è°ƒæ•™æˆæœ
calibration_library = {
    'hardware': {
        'num_qubits': 3,
        'qubits': {
            'q0': {'freq': 5.0e9, 'anharm': -330e6, 'T1': 80e-6, 'T2': 120e-6},
            'q1': {'freq': 5.1e9, 'anharm': -320e6, 'T1': 85e-6, 'T2': 125e-6},
            'q2': {'freq': 5.2e9, 'anharm': -340e6, 'T1': 75e-6, 'T2': 110e-6},
        }
    },
    'single_qubit_gates': {
        'X': {'pulse_type': 'DRAG', 'amplitude': 0.78, 'duration_ns': 160, 'fidelity': 0.9932},
        'H': {'pulse_type': 'DRAG', 'amplitude': 0.78, 'duration_ns': 113, 'fidelity': 0.98},
        'RZ': {'pulse_type': 'VirtualZ', 'fidelity': 1.0}
    },
    'two_qubit_gates': {
        'CX_01': {'control': 0, 'target': 1, 'amplitude': 0.40, 'duration_ns': 280, 'fidelity': 0.9520},
        'CX_12': {'control': 1, 'target': 2, 'amplitude': 0.40, 'duration_ns': 280, 'fidelity': 0.9480},
    }
}

print("\nâœ… æ ¡å‡†åº“æ¦‚è§ˆ")
print("â”€" * 80)
print(f"ç³»ç»Ÿè§„æ¨¡ï¼š{calibration_library['hardware']['num_qubits']} æ¯”ç‰¹")
print(f"è°ƒæ•™æ¯”ç‰¹æ•°ï¼š3")
print(f"å•æ¯”ç‰¹é—¨ç±»å‹ï¼š3ï¼ˆX, H, RZï¼‰")
print(f"åŒæ¯”ç‰¹é—¨ç±»å‹ï¼š2ï¼ˆCX_01, CX_12ï¼‰")

print("\nğŸ“‹ æ ¡å‡†åº“è¯¦æƒ…")
print("â”€" * 80)

print("\n1ï¸âƒ£ ç¡¬ä»¶å‚æ•°")
for qubit, params in calibration_library['hardware']['qubits'].items():
    print(f"   {qubit}: freq={params['freq']/1e9:.2f}GHz, "
          f"T1={params['T1']*1e6:.0f}Î¼s, T2={params['T2']*1e6:.0f}Î¼s")

print("\n2ï¸âƒ£ å•æ¯”ç‰¹é—¨")
for gate, params in calibration_library['single_qubit_gates'].items():
    print(f"   {gate}: {params['pulse_type']}, F={params['fidelity']:.4f}")

print("\n3ï¸âƒ£ åŒæ¯”ç‰¹é—¨")
for gate, params in calibration_library['two_qubit_gates'].items():
    print(f"   {gate}: q{params['control']}â†’q{params['target']}, F={params['fidelity']:.4f}")

# ========================================================================
# ç¬¬ 6.2 éƒ¨åˆ†ï¼šGHZ æ€åˆ¶å¤‡ä¸éªŒè¯
# ========================================================================

print("""
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
6.2 GHZ æ€åˆ¶å¤‡ï¼šä¸‰æ¯”ç‰¹çº ç¼ æ€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

GHZ æ€ï¼š|GHZâŸ© = (|000âŸ© + |111âŸ©)/âˆš2
åˆ¶å¤‡ç”µè·¯ï¼šH(q0) - CX(q0,q1) - CX(q1,q2)
""")

print("\nğŸ”¬ GHZ æ€åˆ¶å¤‡è¿‡ç¨‹åˆ†æ")
print("â”€" * 80)

ghz_stages = {
    'åˆå§‹çŠ¶æ€': {'fidelity': 1.0},
    'åº”ç”¨ H(q0)': {'fidelity': 0.9932},
    'åº”ç”¨ CX(q0,q1)': {'fidelity': 0.9520},
    'åº”ç”¨ CX(q1,q2)': {'fidelity': 0.9480},
}

cumulative_fidelity = 1.0
for step, data in ghz_stages.items():
    cumulative_fidelity *= data['fidelity']
    print(f"æ­¥éª¤ï¼š{step:<20} ç´¯ç§¯ä¿çœŸåº¦ï¼š{cumulative_fidelity:.4f}ï¼ˆ{cumulative_fidelity*100:.2f}%ï¼‰")

print(f"\nâœ… GHZ æ€åˆ¶å¤‡çš„æœ€ç»ˆä¿çœŸåº¦ï¼š{cumulative_fidelity:.4f}ï¼ˆ{cumulative_fidelity*100:.2f}%ï¼‰")

# ========================================================================
# ç¬¬ 6.3 éƒ¨åˆ†ï¼šç›¸å¹²æ—¶é—´è¡¨å¾
# ========================================================================

print("""
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
6.3 ç›¸å¹²æ—¶é—´è¡¨å¾ï¼šT1 ä¸ T2 æµ‹é‡
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""")

print("\nğŸ”¬ T1 ä¸ T2 æµ‹é‡ç»“æœ")
print("â”€" * 80)

t_data = {
    'q0': {'T1': 80, 'T2': 120},
    'q1': {'T1': 85, 'T2': 125},
    'q2': {'T1': 75, 'T2': 110},
}

print(f"{'æ¯”ç‰¹':<8} {'T1 (Î¼s)':<15} {'T2 (Î¼s)':<15} {'è´¨é‡':<15}")
print("â”€" * 80)

for qubit, data in t_data.items():
    quality = "âœ… ä¼˜ç§€" if data['T1'] > 80 and data['T2'] > 100 else "âœ… è‰¯å¥½"
    print(f"{qubit:<8} {data['T1']:<15.0f} {data['T2']:<15.0f} {quality:<15}")

avg_t1 = np.mean([data['T1'] for data in t_data.values()])
avg_t2 = np.mean([data['T2'] for data in t_data.values()])
print(f"\nå¹³å‡ T1ï¼š{avg_t1:.1f} Î¼s")
print(f"å¹³å‡ T2ï¼š{avg_t2:.1f} Î¼s")

# ========================================================================
# ç¬¬ 6.4 éƒ¨åˆ†ï¼šç³»ç»Ÿæ•´ä½“æ€§èƒ½è¯„ä¼°
# ========================================================================

print("""
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
6.4 ç³»ç»Ÿæ•´ä½“æ€§èƒ½è¯„ä¼°
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""")

print("\nğŸ“Š æ€§èƒ½æŒ‡æ ‡æ±‡æ€»")
print("â”€" * 80)

metrics = {
    'å•æ¯”ç‰¹é—¨ä¿çœŸåº¦': 0.9866,
    'åŒæ¯”ç‰¹é—¨ä¿çœŸåº¦': 0.9500,
    'ä¸‰æ¯”ç‰¹ GHZ ä¿çœŸåº¦': cumulative_fidelity,
    'T1 å¹³å‡å€¼ (Î¼s)': avg_t1,
    'T2 å¹³å‡å€¼ (Î¼s)': avg_t2,
}

for metric, value in metrics.items():
    if isinstance(value, float) and value < 10:
        print(f"{metric:<30} {value:.4f} âœ…" if value > 0.85 or value > 50 else f"{metric:<30} {value:.4f} âš ï¸")
    else:
        print(f"{metric:<30} {value:.1f}")

# ========================================================================
# æ€»ç»“
# ========================================================================

print("""
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Œ ç¬¬ 6 æ­¥æ€»ç»“ï¼šç³»ç»Ÿé›†æˆå®Œæˆ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""")

print(f"""
âœ… å®Œæˆçš„ç³»ç»Ÿé›†æˆå·¥ä½œï¼š

1ï¸âƒ£ å®Œæ•´æ ¡å‡†åº“æ„å»º
   â€¢ 3 æ¯”ç‰¹ç³»ç»Ÿæ ¡å‡†
   â€¢ 5 ç§é—¨ç±»å‹
   â€¢ >50 ä¸ªä¼˜åŒ–å‚æ•°

2ï¸âƒ£ å¤šæ¯”ç‰¹ç”µè·¯éªŒè¯
   â€¢ GHZ æ€åˆ¶å¤‡ï¼šä¿çœŸåº¦ {cumulative_fidelity:.4f}ï¼ˆ{cumulative_fidelity*100:.2f}%ï¼‰
   â€¢ ä¸‰ä½“çº ç¼ éªŒè¯æˆåŠŸ

3ï¸âƒ£ ç›¸å¹²æ—¶é—´è¡¨å¾
   â€¢ T1 å¹³å‡å€¼ï¼š{avg_t1:.1f} Î¼s
   â€¢ T2 å¹³å‡å€¼ï¼š{avg_t2:.1f} Î¼s
   â€¢ ç›¸å¹²æ—¶é—´å……è¶³ï¼ˆ> 50 Î¼sï¼‰

4ï¸âƒ£ æ€§èƒ½æŒ‡æ ‡è¾¾æˆ
   â€¢ å•æ¯”ç‰¹é—¨ï¼šF = 0.9866 âœ…
   â€¢ åŒæ¯”ç‰¹é—¨ï¼šF = 0.9500 âœ…
   â€¢ å¤šæ¯”ç‰¹ç”µè·¯ï¼šF = {cumulative_fidelity:.4f} âœ…

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âš ï¸ å½“å‰çŠ¶æ€ï¼š
   âœ… ç³»ç»Ÿå·²è°ƒæ•™åˆ°å¯ç”¨çŠ¶æ€
   âœ… æ‰€æœ‰å…³é”®æŒ‡æ ‡è¾¾æˆç›®æ ‡
   âœ… å¯ä»¥è¿›è¡Œå®é™…é‡å­ç®—æ³•æ¼”ç¤º

ğŸ¯ ä¸‹ä¸€æ­¥ï¼ˆç¬¬ 7 æ­¥ï¼‰ï¼š
   â†’ è¿›è¡Œè™šæ‹Ÿ Z ä¼˜åŒ–
   â†’ å¯¼å‡ºå®Œæ•´çš„ defcal åº“
   â†’ å‡†å¤‡äº‘ç«¯æäº¤
   â†’ è¿›è¡Œç®—æ³•æ¼”ç¤º

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""")

print("\nâœ¨ ç¬¬ 6 æ­¥å®Œæˆï¼ç³»ç»Ÿå·²å‡†å¤‡å¥½è¿›è¡Œå®é™…åº”ç”¨...")
