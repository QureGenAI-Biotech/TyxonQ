# 贡献指南

<cite>
**本文档引用的文件**  
- [CONTRIBUTING.md](file://CONTRIBUTING.md)
- [pyproject.toml](file://pyproject.toml)
- [docs/source/contribution.rst](file://docs/source/contribution.rst)
</cite>

## 目录
1. [简介](#简介)
2. [开发环境搭建](#开发环境搭建)
3. [代码风格与提交规范](#代码风格与提交规范)
4. [测试框架使用说明](#测试框架使用说明)
5. [构建与发布流程](#构建与发布流程)
6. [贡献工作流](#贡献工作流)
7. [社区参与与审核标准](#社区参与与审核标准)

## 简介
TyxonQ 是一个开源的量子计算框架，欢迎所有开发者参与贡献。本指南详细说明了如何参与项目开发，包括环境配置、代码规范、测试方法、构建发布流程以及完整的贡献流程。

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L1-L5)

## 开发环境搭建
要开始开发，请按照以下步骤配置本地环境：

1. 克隆你的 fork 仓库并添加上游远程：
```bash
git clone <your-forked-repo-git-link>
cd tyxonq
git remote add upstream https://github.com/QureGenAI-Biotech/TyxonQ
```

2. 安装项目依赖：
```bash
pip install -r requirements/requirements.txt
pip install -r requirements/requirements-dev.txt
```

3. 以开发模式安装 TyxonQ：
```bash
python setup.py develop
```

4. 确保 Python 版本在 3.10 到 3.12 之间，这是项目要求的版本范围。

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L25-L45)

## 代码风格与提交规范
项目使用 `ruff` 进行代码风格检查，确保代码一致性。相关配置已在 `pyproject.toml` 中定义。

### 代码风格要求
- 遵循 PEP 8 规范
- 使用 `ruff` 自动格式化和检查
- 所有提交必须通过 `./check_all.sh` 脚本的检查

### 提交信息规范
- 提交信息应简洁明了，描述变更内容
- 对于未完成的 PR，请在标题前添加 `[WIP]`
- 每个 PR 建议只包含一个 git 提交，可使用 `git rebase -i` 进行提交压缩

**Section sources**
- [pyproject.toml](file://pyproject.toml#L31)
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L65-L75)

## 测试框架使用说明
项目使用 `pytest` 作为主要测试框架，测试用例分布在多个目录中。

### 运行测试
```bash
pytest -v -ra
```

### 并行测试
安装 `pytest-xdist` 可以并行运行测试以提高速度：
```bash
pip install pytest-xdist
pytest -v -n [进程数]
```

### 测试类型
- **单元测试**：位于 `tests_core_module/` 目录
- **集成测试**：位于 `tests_examples/` 目录
- **化学应用测试**：位于 `tests_applications_chem/` 目录
- **分子验证测试**：位于 `tests_mol_valid/` 目录

### 性能基准测试
安装 `pytest-benchmark` 可运行性能基准测试：
```bash
pip install pytest-benchmark
```

### 测试配置
测试路径已在 `pyproject.toml` 中配置：
```toml
[tool.pytest.ini_options]
testpaths = ["tests_core_module","tests_examples","tests_applications_chem","tests_mol_valid"]
python_files = ["test_*.py"]
addopts = "-v -ra"
```

**Section sources**
- [pyproject.toml](file://pyproject.toml#L65-L69)
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L100-L120)

## 构建与发布流程
### 构建配置
构建系统使用 `setuptools`，配置如下：
```toml
[build-system]
requires = ["setuptools>=65", "wheel"]
build-backend = "setuptools.build_meta"
```

### 发布到 PyPI
```bash
python setup.py sdist bdist_wheel
export VERSION=0.x.y
twine upload dist/tyxonq-${VERSION}-py3-none-any.whl dist/tyxonq-${VERSION}.tar.gz
```

### GitHub 发布
```bash
git tag v0.x.y 
git push origin v0.x.y
```
然后在 GitHub 页面选择从标签创建发布。

### DockerHub 发布
```bash
sudo docker build . -f docker/Dockerfile -t tyxonq
sudo docker tag tyxonq:latest tyxonq/tyxonq:0.x.y
sudo docker push tyxonq/tyxonq:0.x.y
```

**Section sources**
- [pyproject.toml](file://pyproject.toml#L55-L60)
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L200-L250)

## 贡献工作流
1. **问题报告**：在 Issues 页面提交 bug 报告或功能请求
2. **功能请求**：创建 issue 讨论新功能的设计
3. **代码修改**：
   - 创建功能分支：`git checkout -b feature-name`
   - 进行修改并测试
   - 提交更改：`git add` 和 `git commit`
4. **同步上游**：
   ```bash
   git fetch upstream
   git rebase upstream/master
   ```
5. **创建 Pull Request**：
   - 推送分支：`git push --set-upstream origin feature-name`
   - 在 GitHub 上创建 PR
   - 添加相关说明和截图（如有）
6. **代码审查**：根据反馈进行修改
7. **合并**：通过审查后由维护者合并

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L10-L60)

## 社区参与与审核标准
### 社区参与方式
- 回答讨论区或 issue 页面的问题
- 改进文档（docstrings/教程）
- 提交代码贡献
- 参与设计讨论

### 贡献审核标准
- 代码必须通过所有检查（black、mypy、pylint、pytest）
- 必须包含相应的测试用例
- 需要更新 CHANGELOG.md
- 文档需要同步更新
- 大型功能变更建议先通过 issue 讨论
- PR 应该有清晰的描述和目的说明

### 自动化检查
运行 `./check_all.sh` 脚本来验证所有检查：
- black 格式化
- mypy 类型检查
- pylint 代码质量
- pytest 单元测试
- sphinx 文档构建

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L75-L100)